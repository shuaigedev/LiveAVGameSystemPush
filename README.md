# LiveAVGameSystemPush
直播+弹幕互动游戏SDK+直播推流工具架构设计和框架搭建。


01 产品功能简介
LiveGame+：直播+弹幕互动游戏，参考与b站的直播弹幕互动玩法，参考连接：https://play-live.bilibili.com/
得益于弹幕系统的普及行，玩法简单，玩家只要输入弹幕信息就可以跟所有的观看直播用户进行游戏互动。

在了解系统设计方案和架构之前，先看看有哪些核心功能？下面是直播端的参考截图：
![image](https://user-images.githubusercontent.com/107393905/180381080-888125f8-4c5a-4368-8d85-d5a0dc59105b.png)

1.直播的基础功能：连麦互动直播（支持多码率、多协议，多主播同框）、美颜特效、弹幕、IM聊天、点赞、屏幕共享等功能性需求，以及防盗链、涉黄涉政鉴别等非功能性需求。

2.直播平台需要支持互动游戏的联通系统

(1)也就是数据流通信互通方案，主要是弹幕和礼物的监听，玩法本身取决于游戏本身的互动规则

02 面临的技术挑战：

1.基础功能的压力交给了腾讯云，只是集成的各种工作量

2.但是交互系统的压力依旧存在，高并发请求，高带宽压力，高计算压力，这种交互泛娱乐的直播场景还是有挺多技术挑战的，它取决于直播应用的用户量级和业务流程。就算是直播电商这种低频交易转化的场景，要是李佳琪在带货，同样也会面临瞬时抢购的高并发挑战，所以架构设计时必须考虑业务最高峰时的压力，并且系统的各个环节必须具备动态可伸缩的能力。


03 技术选型及依据
一. 音视频处理及传输的方案选型
音视频处理及传输，因为技术团队不具备这方面的能力，调研了各种云厂商的付费解决方案，最终采用了腾讯云的直播解决方案。主持人侧：通过演播室的专业摄像设备，搭载腾讯云提供的obs推流软件，即可进行视频录制和推流。用户侧：Web端集成腾讯云的SDK，动态拿到推流地址后即可观看直播。
第三方开源的框架方案一概不考虑，不稳定，也没有人有能力去维护。出问题都不知道怎么修。


二. 业务数据流的方案选型

业务数据是指除音视频以外的，和互动应用场景相关的数据（比如弹幕和礼物的数据分发，如何跟互动应用进行数据胡同）。腾讯云暂时是没有提供解决方案的：
所以我们必须自己开发就需要做到以下几点：

基于腾讯云SDK实现一套业务层处理的高性能网关服务器，目前能提供的技术选型是：

1、Netty：Netty是当时最流行的高性能和异步NIO框架，直播答题的业务场景中，涉及到题目下发、弹幕、下红包雨等非常多的推送场景，而且一场答题活动中，客户端和服务端的通信频繁，长连接比短连接在性能上更优。

2、ProtoBuf：作为客户端和服务端的数据交换格式，PB是一种效率和兼容性都很优秀的二进制数据传输格式，在码流和序列化速度上明显优于JSON、XML、hessian等主流格式，同时支持向前向后兼容以及各种主流语言。

3、WebSocket：是 HTML5 一种新的协议，用来实现客户端与服务器端的长连接通讯。

而我选择：WebSocket，更加适合Web端的通信，更好的适配第三方互动游戏的SDK接入，实现起来也方便。B站也是用的WebSocket。

04 架构设计方案

一.音视频直播架构 
![image](https://user-images.githubusercontent.com/107393905/180381153-23eb87e3-d8b0-4ca2-97db-3fa5b70dc4bd.png)

上面是腾讯云直播解决方案的架构图，其他云厂商的直播解决方案，技术架构类似。

二.数据流方案
![image](https://user-images.githubusercontent.com/107393905/180381166-a2b56596-8870-4788-8b9f-9012be60661d.png)

三. 基于TCP长连接的通信架构
![image](https://user-images.githubusercontent.com/107393905/180381136-f12b4c07-e385-464a-957c-755f8d7820eb.png)

我们缺少的就是基于交互系统的服务器业务系统

总结：
1.rtmp推流工具

(1)现成的腾讯云TRTC SDK+腾讯云自带的后台服务器系统

(2)OBS (二次开发难度太大，且弹幕本身还需要额外开发)，到时候为obs做一个基于我们业务系统的弹幕插件

(3)大牛直播SDK（等同于阉割版的OBS，二次开发你难度略比obs小却没有obs强大）

2.交互系统

(1)考虑websocket+RabbitMQ+Nginx+接入腾讯云的SDK接口（考虑用云函数实现，做到运算和转发无压力）

3.交互小游戏的SDK开发

(1)需要接入交互系统，有身份识别功能，对应房间ID进行数据交互
